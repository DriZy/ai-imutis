#apiVersion: v1
#kind: Service
#metadata:
#  name: redis
#  namespace: ai-imutis
#  labels:
#    app: redis
#spec:
#  type: ClusterIP
#  clusterIP: None
#  selector:
#    app: redis
#  ports:
#  - name: redis
#    port: 6379
#    targetPort: 6379
#    protocol: TCP
#
#---
#apiVersion: v1
#kind: PersistentVolumeClaim
#metadata:
#  name: redis-pvc
#  namespace: ai-imutis
#spec:
#  accessModes:
#    - ReadWriteOnce
#  resources:
#    requests:
#      storage: 20Gi
#  storageClassName: fast-ssd
#
#---
#apiVersion: apps/v1
#kind: StatefulSet
#metadata:
#  name: redis
#  namespace: ai-imutis
#  labels:
#    app: redis
#spec:
#  serviceName: redis
#  replicas: 1
#  selector:
#    matchLabels:
#      app: redis
#  template:
#    metadata:
#      labels:
#        app: redis
#    spec:
#      securityContext:
#        fsGroup: 999
#        runAsNonRoot: true
#        runAsUser: 999
#
#      containers:
#      - name: redis
#        image: redis:7-alpine
#        imagePullPolicy: IfNotPresent
#
#        securityContext:
#          allowPrivilegeEscalation: false
#          capabilities:
#            drop:
#              - ALL
#          readOnlyRootFilesystem: false
#
#        command:
#        - redis-server
#        - /usr/local/etc/redis/redis.conf
#
#        ports:
#        - name: redis
#          containerPort: 6379
#          protocol: TCP
#
#        resources:
#          requests:
#            cpu: "250m"
#            memory: "256Mi"
#          limits:
#            cpu: "1000m"
#            memory: "1Gi"
#
#        livenessProbe:
#          exec:
#            command:
#            - redis-cli
#            - ping
#          initialDelaySeconds: 10
#          periodSeconds: 10
#          timeoutSeconds: 5
#          failureThreshold: 3
#
#        readinessProbe:
#          exec:
#            command:
#            - redis-cli
#            - ping
#          initialDelaySeconds: 5
#          periodSeconds: 5
#          timeoutSeconds: 3
#          failureThreshold: 3
#
#        volumeMounts:
#        - name: redis-storage
#          mountPath: /data
#        - name: redis-config
#          mountPath: /usr/local/etc/redis
#          readOnly: true
#
#      volumes:
#      - name: redis-config
#        configMap:
#          name: redis-config
#          defaultMode: 0644
#
#  volumeClaimTemplates:
#  - metadata:
#      name: redis-storage
#    spec:
#      accessModes:
#        - ReadWriteOnce
#      storageClassName: fast-ssd
#      resources:
#        requests:
#          storage: 20Gi
#
#---
#apiVersion: v1
#kind: ConfigMap
#metadata:
#  name: redis-config
#  namespace: ai-imutis
#data:
#  redis.conf: |
#    # Redis configuration for AI-IMUTIS rate limiting and caching
#    bind 0.0.0.0
#    port 6379
#
#    # Persistence
#    save 900 1
#    save 300 10
#    save 60 10000
#    appendonly yes
#    appendfsync everysec
#
#    # Memory management
#    maxmemory 1gb
#    maxmemory-policy allkeys-lru
#
#    # Connection settings
#    tcp-backlog 511
#    timeout 0
#    tcp-keepalive 300
#
#    # Logging
#    loglevel notice
#
#    # Database
#    databases 16
#
#    # AOF rewrite settings
#    auto-aof-rewrite-percentage 100
#    auto-aof-rewrite-min-size 64mb
#
#    # Keyspace notifications for monitoring
#    notify-keyspace-events "Ex"
#
#---
#apiVersion: policy/v1
#kind: PodDisruptionBudget
#metadata:
#  name: redis-pdb
#  namespace: ai-imutis
#spec:
#  minAvailable: 1
#  selector:
#    matchLabels:
#      app: redis
